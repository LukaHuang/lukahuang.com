---
author: Luka
title: "ç”¨ Harbor æ¶è¨­ Private Docker Registry"
published: true
date: 2019-12-17 10:32
tags:
  - Harbor
  - Docker
comments: true
---

## ç”¨ Harbor æ¶è¨­ä¸€å€‹åƒ…ä¾›å…¬å¸å…§ç¶²å­˜å–çš„ Docker Registry

![](https://cdn-images-1.medium.com/max/2000/1*zYNBpVXtxGID9rttcSYklQ.jpeg)

## ä»€éº¼æ˜¯ Docker Registry ï¼Ÿ

é¡§åæ€ç¾©å°±æ˜¯ç”¨ä¾†å„²å­˜é¡åƒæª” (Image) çš„åœ°æ–¹ã€‚ä¾‹å¦‚ï¼šDockerHub å°±æ˜¯ Docker å®˜æ–¹æä¾›çš„ Docker Registryï¼Œä½ å¯ä»¥æŠŠä½ è‡ªå·±ç·¨å¯«çš„ Dockerfile ç·¨è­¯ä¹‹å¾Œä¸Šå‚³åˆ° Dockerhub ï¼Œè®“ç¶²è·¯ä¸Šçš„å…¶ä»–äººè‡ªç”±çš„ä¸‹è¼‰ï¼Œè®“å¤§å®¶ç«™åœ¨ä½ çš„è‚©è†€ä¸Šå¯«ç¨‹å¼ã€‚

![Dockerhub é¦–é ](https://cdn-images-1.medium.com/max/2402/1*xCluFgOIs4GgoiAFkxIOJg.png)

![åœ¨ dockerhub ä¸Šé¢å¯ä»¥æœå°‹åˆ° ubuntu å®˜æ–¹é‡‹å‡ºçš„ docker image](https://cdn-images-1.medium.com/max/2328/1*5V65KKaQS5QlDeSEMW6Crg.png)

## ç‚ºä»€éº¼è¦æ¶è¨­ç§æœ‰çš„ Docker Registryï¼Ÿ

åœ¨é€™å€‹å®¹å™¨åŒ–çš„æ™‚ä»£ï¼Œ è¦ä½¿ç”¨ Kubernetes ç”Ÿæ…‹ç³»ï¼Œç¬¬ä¸€æ­¥æ˜¯å°‡åŸæœ¬çš„å¯¦é«”æ©Ÿå™¨çš„é…ç½®è½‰æ›æˆç¨‹å¼ç¢¼ï¼Œè½‰æ›å®Œæˆå¾Œè®Šæˆ Dockerfileï¼ŒDockerfile ç·¨å¯«è‘—é€™å°æ©Ÿå™¨ä¸Šæ‰€æœ‰çš„é…ç½®ã€‚

æˆ‘å€‘éœ€è¦æ‰¾ä¸€å€‹åœ°æ–¹å­˜æ”¾ç”±é€™äº› Dockerfile å»ºç«‹ (build) å‡ºä¾†çš„ Docker é¡åƒæª”ï¼Œé€™äº›é¡åƒæª”ç¸½ä¸èƒ½æ”¾åœ¨ Dockerhub ä¸Šçµ¦å¤§å®¶ä¸€è¦½ç„¡éºå§ï¼Ÿå› æ­¤æˆ‘å€‘éœ€è¦ä¸€å€‹ç§æœ‰çš„ Docker Registry ä¾†æ”¾ç½®å»ºç«‹çš„ Docker é¡åƒæª”ã€‚

## Harbor æ˜¯ä»€éº¼ï¼Ÿ

Harbor æ˜¯ç”± VMware ç™¼è¡Œçš„é¡åƒæª”å„²å­˜å€‰åº«ï¼Œå°±æ˜¯ä½ è‡ªè¡Œæ¶è¨­ä¸€å€‹åªæœ‰å…¬å¸å…§éƒ¨å¯ä»¥å­˜å–åˆ°çš„ Dockerhubï¼Œå…¬å¸å…§éƒ¨ä½¿ç”¨çš„é¡åƒæª”éƒ½ä¸Šå‚³åˆ°ä¸Šé¢ï¼Œè¦ä½¿ç”¨æ™‚ä¹Ÿéƒ½å¾ Harbor ä¸­æ‹‰ä¸‹ä¾† (pull image)ã€‚

Harbor çš„ç®¡ç†ä»‹é¢å¦‚ä¸‹

![](https://cdn-images-1.medium.com/max/3052/1*pl2f1k9c_PdW_QWxRf1cAQ.png)

æ¯ä¸€å€‹å°ˆæ¡ˆå¯ä»¥æœ‰å¤šå€‹ Repositoryï¼Œè€Œæ¯å€‹ Repository å¯ä»¥ä¸Šå‚³å¤šå€‹ Image

![](https://cdn-images-1.medium.com/max/3078/1*l76NWolqE7O0t0rGAafk6A.png)

## Harbor åœ¨ CI/CD ä¸­æ‰®æ¼”çš„è§’è‰²

ç”¨ä¸€å¼µåœ–è¡¨ä¾†èªªæ˜ Docker Registry åœ¨ CI / CD æµç¨‹ä¸­æ‰®æ¼”çš„è§’è‰²ï¼š

![](https://cdn-images-1.medium.com/max/2808/1*M69pOie1Kw6U1G36CC6sVA.png)

é¦–å…ˆæˆ‘å€‘æŠŠç¨‹å¼ç¢¼æ¨ä¸Š Githubï¼Œè§¸ç™¼ CI / CD (ä»¥ Jenkins ç‚ºä¾‹) Pipelineï¼ŒPipeline ä¸­åŒ…å«è·‘æ¸¬è©¦ã€ç¨‹å¼ç¢¼å“è³ªæª¢æ¸¬ â€¦ ç­‰ç­‰çš„æ­¥é©Ÿï¼Œä¾ç…§éœ€æ±‚è‡ªç”±å®šç¾©ã€‚

è·‘å®Œ CI / CD Pipeline å¾Œä¾¿æœƒæŠŠ Docker Image æ¨ä¸Š Harborã€‚æ¥è‘—å¦‚æœ K8S éœ€è¦å–ç”¨æ™‚ä¾¿æœƒå¾ Harbor æ‹‰å– (pull) éœ€è¦çš„ç‰ˆæœ¬çš„ Imageã€‚

è¨»ï¼šæ›´å®‰å…¨çš„ä½œæ³•æ˜¯ Github ç”¨ç§æœ‰çš„ç¨‹å¼ç¢¼å„²å­˜åº«å–ä»£ï¼Œé€™é‚Šç‚ºäº†ç°¡å–®ç¤ºæ„ï¼Œç”¨ Github ä½œç‚ºç¨‹å¼ç¢¼å„²å­˜åº«çš„ä»£è¡¨ã€‚

## å¦‚ä½•æ¶è¨­ Harborï¼Ÿ

### Harbor çš„å®‰è£æ–¹å¼

åœ¨ Github ä¸Šé¢å¯ä»¥çœ‹åˆ° Harbor æ˜¯ 1 è¬é¡†æ˜Ÿæ˜Ÿä»¥ä¸Šçš„å¤§å‹é–‹æºå°ˆæ¡ˆ

![](https://cdn-images-1.medium.com/max/2260/1*CH1EH9Z67Zb1Ly-yLwq9Kg.png)

æ‰¾åˆ° Install && Run å€åŸŸçš„èªªæ˜ï¼Œä¸Šé¢å¯«è‘—å…ˆä¸‹è¼‰ binary æª”æ¡ˆï¼Œç„¶å¾Œè·Ÿè‘—å®‰è£æ‰‹å†Šæ“ä½œã€‚

![](https://cdn-images-1.medium.com/max/2126/1*B-Q22EUDNzCgm0iMguOZOA.png)

æˆ‘å€‘å°±é€²å…¥åˆ° [Harbor Release](https://github.com/goharbor/harbor/releases) é é¢

![](https://cdn-images-1.medium.com/max/2264/1*ROVmxJmXqeKol5YLfjjN8w.png)

å¾€ä¸‹å·æ‰¾åˆ° Assets å€åŸŸ

![](https://cdn-images-1.medium.com/max/2014/1*lNDshHJA-X-ZyF6EG_e_3g.png)

é€™æ™‚æˆ‘å€‘é»é¸ online installler ä¸‹è¼‰ï¼Œå¦‚æœåœ¨ linux ä¸»æ©Ÿä¸Šå¯ä»¥ç”¨ wget å–å¾—ã€‚

### å®‰è£ Docker èˆ‡ Docker Compose

æ¥è‘—åˆ° [Harbor Installation and Configuration Guide](https://github.com/goharbor/harbor/blob/master/docs/installation_guide.md) è§€çœ‹æ•™å­¸é€æ­¥å®Œæˆå®‰è£ï¼Œå®‰è£ Harbor æ™‚éœ€è¦å®‰è£ Docker èˆ‡ Docker Composeã€‚

é¦–å…ˆæˆ‘å€‘éœ€è¦å®‰è£ Dockerï¼Œç”¨ Ubuntu 18.04 ä¾†æ¼”ç·´ï¼šåƒè€ƒ [How To Install and Use Docker on Ubuntu 18.04](https://www.digitalocean.com/community/tutorials/how-to-install-and-use-docker-on-ubuntu-18-04) é€æ­¥å®Œæˆ docker å®‰è£ã€‚

é™¤äº†éœ€è¦ Docker ä»¥å¤–ï¼Œé‚„éœ€è¦ docker-composeï¼Œåƒè€ƒ [How To Install Docker Compose on Ubuntu 18.04](https://www.digitalocean.com/community/tutorials/how-to-install-docker-compose-on-ubuntu-18-04)ã€‚

### ç¹¼çºŒå®‰è£ Harbor

å–å¾—å‰›å‰› release ç•«é¢ç²å¾—çš„å®‰è£åŒ…ä½ç½®

```
wget https://github.com/goharbor/harbor/releases/download/v1.10.0/harbor-online-installer-v1.10.0.tgz
```

è§£å£“ç¸®ä¹‹

```
tar xvf harbor-online-installer-v1.10.0.tgz
```

ç¾åœ¨ä½ æœ‰ harbor å®‰è£æª”è³‡æ–™å¤¾

![](https://cdn-images-1.medium.com/max/2000/1*oucT344pLoZU6e0MUKr_Cg.png)

é€²å…¥ harbor è³‡æ–™å¤¾ï¼Œçœ‹åˆ°æœ‰å¹¾å€‹æª”æ¡ˆï¼Œinstall.sh å°±æ˜¯å®‰è£æª”äº†ï¼Œé¦–å…ˆæˆ‘å€‘è¦å…ˆä¿®æ”¹ harbor.yml

![](https://cdn-images-1.medium.com/max/2000/1*W2KPqrMFv2TC--85ciaIdw.png)

å°‡ hostname ä¿®æ”¹ï¼Œå¦å‰‡ç›´æ¥é‹è¡Œ install.sh æ˜¯æœƒç™¼ç”ŸéŒ¯èª¤çš„ã€‚é™¤äº†ä¿®æ”¹ hostman ä»¥å¤–ï¼Œä¿®æ”¹ admin password é è¨­ç®¡ç†å“¡å¯†ç¢¼ï¼Œå¯ä»¥å¢åŠ å®‰å…¨æ€§ã€‚

![](https://cdn-images-1.medium.com/max/2000/1*jDUzW33Dqar1YOkZWwzgpg.png)

ä¿®æ”¹å®Œæˆå¾ŒåŸ·è¡Œ sudo ./install.shï¼Œharbor éœ€è¦çš„æœå‹™å°±æœƒä¾åºè¢«å»ºç«‹èµ·ä¾†ï¼Œå°±æ˜¯é€™éº¼ç°¡å–®ã€‚

æ­¤æ™‚è¨ªå•é€™å°æ©Ÿå™¨çš„ ip ä½ç½®ï¼Œå°±æœƒå‡ºç¾ç™»å…¥ç•«é¢å›‰ï¼

## çµèª

ç¾åœ¨ä½ æ“æœ‰äº†ä¸€å€‹å¯ä»¥æ”¾åœ¨å…¬å¸å…§ç¶²çš„ Docker Registryï¼Œä½ å¯ä»¥åœ¨ä¸Šé¢è‡ªç”±çš„ä¸Šå‚³è‡ªå·±å»ºç«‹çš„ Docker Imageï¼Œä¸ç”¨æ€•è¢«çœ‹å…‰å…‰ï¼Œæ˜¯ä¸æ˜¯å¾ˆæ£’å‘¢ã€‚

å¦‚æœå–œæ­¡æˆ‘å¯«çš„æ–‡ç« ï¼Œæ­¡è¿è¿½è¹¤æœ¬äººå¸³è™Ÿ [@LukaTw](https://medium.com/@LukaTw) èˆ‡ [StarBugs Weekly æ˜Ÿå·´å“¥æŠ€è¡“é€±åˆŠ](https://medium.com/starbugs) ğŸ™‚ğŸ™‚ğŸ™‚
